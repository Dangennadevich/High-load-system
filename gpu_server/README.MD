<h1 align="center">Проект по распознованию сгенерированного AI моделью текста</h1>

Проект по распознованию AI-сгенерированного текста, основные компоненты:

    * CPU сервер с FastAPI сервером, на котором будет происходить взаимодействие с пользователем.
    
    * GPU сервер с AI моделью, которая проводит скоринг по запросу с CPU сервера.


<h2 align="center">GPU часть проекта</h2>

Запускается на втором сервере архитектуры - GPU. Сервис ожидает сообщение пользователя от CPU сервера, выполняет обработку, результат записывает в БД.

Клиент отправляет запрос на CPU сервер (бекенд веб приложения), CPU сервер отправляет запрос на обработку текста в GPU сервер через брокера сообщений rabbitmq и записывает лог в БД PSQL. GPU получает запрос на обработку через rabbitmq, результат кладет в БД обновляя лог оставленный CPU сервисом.
 

Связи сервиса с другими объектами архитектуры: **CPU >> GPU >> PSQL DB**


<h2 align="center">Настройка сервисов на GPU</h2>

Выполняется после развертывания необходимого ПО на сервере (~/README.MD, пункт 1-3) и поднятии инфраструктуры на CPU сервере (~/cpu_server/README.MD)

<h3 align="center">2. Поднимаем сервисы </h3>

<b>2.1 Создаем секреты </b>

<code>kubectl create secret generic app-secrets \
  --from-env-file=.env \
  -n default</code>

<h5 align="left">2.2 fastapi-service</h5>

<b>2.2.1 Создаем контейнер на основе Dockerfile </b>

<code>eval $(minikube docker-env)</code>

<code>docker build -t ai-model-app:latest .</code>

<b>2.2.2 Применяем манифесты </b>

<code>kubectl apply -f k8s/model-fastapi-deployment.yaml</code>

<code>kubectl apply -f k8s/model-fastapi-service.yaml</code>

<b>2.2.3 Проверка pods </b>

<code>kubectl get pods -l app=model-fastapi-app</code>

<b>2.2.4 Проверка сервиса </b>

<code>curl -v http://localhost:8000</code>


<h1 align="center">Файлы из директории GPU сервера</h1>

**main.py** - скрипт для запуска сервиса на GPU сервере. В дальнейшем тут будет работать AI модель по распознованию
сгенерированного текста другой AI моделью, на данный момент тут стоит заглушка np.random.rand()

**Dockerfile** Инструкция для развертывания сервиса с "моделью"

**pyproject.toml** Poetry инструкция для настройки виртуального окружения

**/k8s** Директория с конфигами/манифестами для сервисов k8s